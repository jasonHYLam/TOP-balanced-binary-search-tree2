(()=>{"use strict";function t(l){if(1===l.length)return l;{const e=Math.ceil(l.length/2);let r=t(l.slice(0,e)),n=t(l.slice(e)),i=[];for(;r[0]||n[0];)r[0]<n[0]?(i.push(r[0]),r.shift()):n[0]<r[0]?(i.push(n[0]),n.shift()):r[0]==n[0]?(i.push(r[0]),i.push(n[0]),r.shift(),n.shift()):r[0]?n[0]||(i.push(r[0]),r.shift()):(i.push(n[0]),n.shift());return i}}class l{constructor(t){this.data=t,this.left=null,this.right=null}}function e(l){let e=t(l);return r([...new Set(e)])}function r(t){if(0===t.length)return null;{const e=Math.floor(t.length/2),n=new l(t[e]);return n.left=r(t.slice(0,e)),n.right=r(t.slice(e+1)),n}}const n=(t,l="",e=!0)=>{null!==t&&(null!==t.right&&n(t.right,`${l}${e?"│   ":"    "}`,!1),console.log(`${l}${e?"└── ":"┌── "}${t.data}`),null!==t.left&&n(t.left,`${l}${e?"    ":"│   "}`,!0))};let i=new class{constructor(t){this.root=e(t)}insert(t){!function t(e,r){if(r<e.data&&null==e.left){const t=new l(r);e.left=t}else if(r>e.data&&null==e.right){const t=new l(r);e.right=t}else{if(r<e.data)return t(e.left,r);if(r>e.data)return t(e.right,r);if(r==e.data)return void console.log("value already in tree, try another value")}}(this.root,t)}delete(t){!function t(l,e){if(l.left&&l.left.data===e&&null===l.left.left&&null===l.left.right)l.left=null;else if(l.right&&l.right.data===e&&null===l.right.left&&null===l.right.right)l.right=null;else if(l.left&&l.left.data===e&&null!==l.left.left&&null===l.left.left.left&&null===l.left.left.right&&null===l.left.right)l.left=l.left.left;else if(l.left&&l.left.data===e&&null!==l.left.right&&null===l.left.right.left&&null===l.left.right.right&&null===l.left.left)l.left=l.left.right;else if(l.right&&l.right.data===e&&null!==l.right.left&&null===l.right.left.left&&null===l.right.left.right&&null===l.right.right)l.right=l.right.left;else if(l.right&&l.right.data===e&&null!==l.right.right&&null===l.right.right.left&&null===l.right.right.right&&null===l.right.left)l.right=l.right.right;else if(l.data===e&&null!==l.left&&null!==l.right){let t=l.right,e=t;for(;null!==t.left;)e=t,t=t.left;l.data=t.data,e.left=null}else{if(e>l.data&&null===l.right)return void console.log(`${e} not found, please try again`);if(e<l.data&&null===l.left)return void console.log(`${e} not found, please try again`);if(e<l.data)return t(l.left,e);if(e>l.data)return t(l.right,e)}}(this.root,t)}find(t){!function t(l,e){if(l.data===e)return console.log(l),l;if(e>l.data&&null===l.right)console.log(`${e} not found`);else if(e<l.data&&null===l.left)console.log(`${e} not found`);else{if(e>l.data)return t(l.right,e);if(e<l.data)return t(l.left,e)}}(this.root,t)}levelOrderIterative(t){let l=[];if(l.push(this.root),!t){let t=[];for(;0!==l.length;)t.push(l[0].data),l[0].left&&l.push(l[0].left),l[0].right&&l.push(l[0].right),l.shift();return t}for(;0!==l.length;)t(l[0]),l[0].left&&l.push(l[0].left),l[0].right&&l.push(l[0].right),l.shift()}preOrder(t){if(!t){function l(t){let e=[t.data];return null===t.left&&null===t.right?[t.data]:(t.left&&(e=e.concat(l(t.left))),t.right&&(e=e.concat(l(t.right))),e)}return l(this.root)}{function e(l){t(l),null===l.left&&null===l.right||(l.left&&e(l.left),l.right&&e(l.right))}e(this.root)}}inOrder(t){if(!t){function l(t){let e=[];return t.left&&(e=e.concat(l(t.left))),e=e.concat([t.data]),t.right&&(e=e.concat(l(t.right))),e}return l(this.root)}{function e(l){null===l.left&&null===l.right?t(l):(l.left&&e(l.left),t(l),l.right&&e(l.right))}e(this.root)}}postOrder(t){if(!t){function l(t){let e=[];return t.left&&(e=e.concat(l(t.left))),t.right&&(e=e.concat(l(t.right))),e=e.concat([t.data]),e}return l(this.root)}{function e(l){null===l.left&&null===l.right||(l.left&&e(l.left),l.right&&e(l.right)),t(l)}e(this.root)}}height(t){return function t(l,e=0,r=[]){try{return null==l.left&&null==l.right?r.push(e):(l.left&&t(l.left,e+1,r),l.right&&t(l.right,e+1,r)),Math.max(...r)}catch(t){return"value not found"}}(function t(l,e){return l.data===e?l:e>l.data&&null===l.right||e<l.data&&null===l.left?void 0:e>l.data?t(l.right,e):e<l.data?t(l.left,e):void 0}(this.root,t))}depth(t){return function t(l,e,r=0){if(l.data===e)return r;if(null==l.left&&null==l.right)console.log("value not found");else{if(e<l.data)return t(l.left,e,r+1);if(e>l.data)return t(l.right,e,r+1)}}(this.root,t)}isBalanced(){return function t(l,e=[]){if(null===l.left&&null!==l.right){if(null===l.right.left&&null===l.right.right)return;e.push(!1)}else{if(null===l.left||null!==l.right)return l.left&&t(l.left,e),l.right&&t(l.right,e),!e.includes(!1);if(null===l.left.left&&null===l.left.right)return;e.push(!1)}}(this.root)}rebalance(){if(!this.isBalanced()){const t=this.inOrder();this.root=e(t)}}}(function(){let t=[];for(let l=0;l<10;l++)t.push(Math.floor(100*Math.random()));return t}());console.log(i.isBalanced()),console.log("level order",i.levelOrderIterative()),console.log("pre order",i.preOrder()),console.log("post order",i.postOrder()),console.log("in order",i.inOrder()),function(t){for(let l=0;l<10;l++)t.insert(Math.floor(999*Math.random())+100)}(i),n(i.root),i.rebalance(),console.log(i.isBalanced()),n(i.root),i.find(6),i.find(1),i.find(5),i.levelOrderIterative(),i.preOrder(),i.postOrder()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0osWUFDQUMsRUFBUVUsWUFFWlosUUFBUUMsSUFDSixhQUNBQyxFQUFRYyxhQUVaaEIsUUFBUUMsSUFDSixXQUNBQyxFQUFRYSxXQWpDWixTQUF1Qm9CLEdBSW5CLElBQUssSUFBSUgsRUFBSSxFQUFHQSxFQUhTLEdBR2FBLElBQ2xDRyxFQUFLaEMsT0FBTzdCLEtBQUtvQixNQUhOLElBR1lwQixLQUFLMkQsVUFBcUIsSUFFekQsQ0E2QkFHLENBQWNsQyxHQUdkTixFQUFZTSxFQUFRUCxNQUVwQk8sRUFBUTJCLFlBRVI3QixRQUFRQyxJQUNKQyxFQUFRdUIsY0FHWjdCLEVBQVlNLEVBQVFQLE1BSXBCTyxFQUFRTSxLQUFLLEdBQ2JOLEVBQVFNLEtBQUssR0FDYk4sRUFBUU0sS0FBSyxHQUliTixFQUFRTyxzQkFDUlAsRUFBUVUsV0FNUlYsRUFBUWMsVyIsInNvdXJjZXMiOlsid2VicGFjazovL3RvcC1iYWxhbmNlZC1iaW5hcnktc2VhcmNoLXRyZWUyLy4vc3JjL21lcmdlU29ydC5qcyIsIndlYnBhY2s6Ly90b3AtYmFsYW5jZWQtYmluYXJ5LXNlYXJjaC10cmVlMi8uL3NyYy9CU1QuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhbGFuY2VkLWJpbmFyeS1zZWFyY2gtdHJlZTIvLi9zcmMvcHJldHR5UHJpbnQuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhbGFuY2VkLWJpbmFyeS1zZWFyY2gtdHJlZTIvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIG1lcmdlU29ydChhcnJheSkge1xuICAgIGlmIChhcnJheS5sZW5ndGggPT09IDEpIHJldHVybiBhcnJheTtcbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgaGFsZiA9IE1hdGguY2VpbChhcnJheS5sZW5ndGgvMilcbiAgICAgICAgLy8gc3BsaXQgYXJyYXkgaW4gaGFsZlxuICAgICAgICBjb25zdCBsZWZ0SGFsZiA9IGFycmF5LnNsaWNlKDAsIGhhbGYpXG4gICAgICAgIC8vIGNhbGwgbWVyZ2VTb3J0IG9uIHRoZSBsZWZ0IGhhbGZcbiAgICAgICAgbGV0IHNvcnRlZExlZnRIYWxmID0gbWVyZ2VTb3J0KGxlZnRIYWxmKVxuXG4gICAgICAgIGNvbnN0IHJpZ2h0SGFsZiA9IGFycmF5LnNsaWNlKGhhbGYpXG4gICAgICAgIC8vIGNhbGwgbWVyZ2VTb3J0IG9uIHRoZSByaWdodCBoYWxmXG4gICAgICAgIGxldCBzb3J0ZWRSaWdodEhhbGYgPSBtZXJnZVNvcnQocmlnaHRIYWxmKTtcblxuICAgICAgICAvL2ZvciBlYWNoIGVsZW1lbnQgaW4gbGVmdCBoYWxmIGFuZCByaWdodCBoYWxmLCBzZWUgd2hpY2ggaXMgc21hbGxlclxuICAgICAgICBsZXQgbWVyZ2VkQXJyYXkgPSBbXTtcbiAgICAgICAgd2hpbGUgKHNvcnRlZExlZnRIYWxmWzBdIHx8IHNvcnRlZFJpZ2h0SGFsZlswXSkge1xuICAgICAgICAgICAgLy8gaWYgKHNvcnRlZExlZnRIYWxmWzFdIDwgc29ydGVkUmlnaHRIYWxmWzBdKSB7IGlzIHRoaXMgd3Jvbmc/XG4gICAgICAgICAgICBpZiAoc29ydGVkTGVmdEhhbGZbMF0gPCBzb3J0ZWRSaWdodEhhbGZbMF0pIHtcbiAgICAgICAgICAgICAgICBtZXJnZWRBcnJheS5wdXNoKHNvcnRlZExlZnRIYWxmWzBdKVxuICAgICAgICAgICAgICAgIHNvcnRlZExlZnRIYWxmLnNoaWZ0KClcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc29ydGVkUmlnaHRIYWxmWzBdIDwgc29ydGVkTGVmdEhhbGZbMF0pIHtcbiAgICAgICAgICAgICAgICBtZXJnZWRBcnJheS5wdXNoKHNvcnRlZFJpZ2h0SGFsZlswXSlcbiAgICAgICAgICAgICAgICBzb3J0ZWRSaWdodEhhbGYuc2hpZnQoKVxuXG4gICAgICAgICAgICAgICAgLy8gZWRnZSBjYXNlIHdoZXJlIHRoZSBzYW1lIG51bWJlciBpcyBiZWluZyBjb21wYXJlZFxuICAgICAgICAgICAgfSBlbHNlIGlmIChzb3J0ZWRMZWZ0SGFsZlswXSA9PSBzb3J0ZWRSaWdodEhhbGZbMF0pIHtcbiAgICAgICAgICAgICAgICBtZXJnZWRBcnJheS5wdXNoKHNvcnRlZExlZnRIYWxmWzBdKVxuICAgICAgICAgICAgICAgIG1lcmdlZEFycmF5LnB1c2goc29ydGVkUmlnaHRIYWxmWzBdKVxuICAgICAgICAgICAgICAgIHNvcnRlZExlZnRIYWxmLnNoaWZ0KClcbiAgICAgICAgICAgICAgICBzb3J0ZWRSaWdodEhhbGYuc2hpZnQoKVxuICAgICAgICAgICAgICAgIC8vIGVkZ2UgY2FzZSB3aGVyZSBvbmUgYXJyYXkgaXMgZW1wdHlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNvcnRlZExlZnRIYWxmWzBdKSB7XG4gICAgICAgICAgICAgICAgbWVyZ2VkQXJyYXkucHVzaChzb3J0ZWRSaWdodEhhbGZbMF0pXG4gICAgICAgICAgICAgICAgc29ydGVkUmlnaHRIYWxmLnNoaWZ0KClcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNvcnRlZFJpZ2h0SGFsZlswXSkge1xuICAgICAgICAgICAgICAgIG1lcmdlZEFycmF5LnB1c2goc29ydGVkTGVmdEhhbGZbMF0pXG4gICAgICAgICAgICAgICAgc29ydGVkTGVmdEhhbGYuc2hpZnQoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVyZ2VkQXJyYXk7XG4gICAgfVxufSIsIi8vIGltcG9ydCB7IG5vZGUgfSBmcm9tIFwid2VicGFja1wiO1xuaW1wb3J0IHsgbWVyZ2VTb3J0IH0gZnJvbSBcIi4vbWVyZ2VTb3J0XCI7XG5cbmltcG9ydCB7IHByZXR0eVByaW50IH0gZnJvbSBcIi4vcHJldHR5UHJpbnRcIjtcblxuY2xhc3MgTm9kZSB7XG4gICAgY29uc3RydWN0b3IodmFsdWUpIHtcbiAgICAgICAgdGhpcy5kYXRhPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5sZWZ0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5yaWdodCA9IG51bGw7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFRyZWUge1xuICAgIGNvbnN0cnVjdG9yKGFycmF5KSB7XG4gICAgICAgIHRoaXMucm9vdCA9IGJ1aWxkVHJlZShhcnJheSk7XG4gICAgfVxuXG5cbiAgICBpbnNlcnQodmFsdWUpIHtcbiAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlRnVuY3Rpb24obm9kZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA8IG5vZGUuZGF0YSAmJiBub2RlLmxlZnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld05vZGUgPSBuZXcgTm9kZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgbm9kZS5sZWZ0ID0gbmV3Tm9kZTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+IG5vZGUuZGF0YSAmJiBub2RlLnJpZ2h0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdOb2RlID0gbmV3IE5vZGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIG5vZGUucmlnaHQgPSBuZXdOb2RlO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgbm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUubGVmdCwgdmFsdWUpXG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBub2RlLmRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjdXJzaXZlRnVuY3Rpb24obm9kZS5yaWdodCwgdmFsdWUpXG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gbm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ2YWx1ZSBhbHJlYWR5IGluIHRyZWUsIHRyeSBhbm90aGVyIHZhbHVlXCIpXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmVjdXJzaXZlRnVuY3Rpb24odGhpcy5yb290LCB2YWx1ZSlcbiAgICB9XG5cbiAgICBkZWxldGUodmFsdWUpIHtcbiAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlRnVuY3Rpb24obm9kZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgY29kZSByZXF1aXJlcyBndWFyZCBjbGF1c2U6IGlmKG5vZGUubGVmdCksIG9yIGlmKG5vZGUucmlnaHQpXG4gICAgICAgICAgICAvLyBjb25zaWRlciBhdCBsZWFzdCA0IGNhc2VzXG4gICAgICAgICAgICAvLyBDYXNlIDE6IGRlbGV0aW5nIHRoZSBsZWFmIG5vZGVcbiAgICAgICAgICAgIGlmIChub2RlLmxlZnQgJiYgbm9kZS5sZWZ0LmRhdGEgPT09IHZhbHVlICYmIG5vZGUubGVmdC5sZWZ0ID09PSBudWxsICYmIG5vZGUubGVmdC5yaWdodCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLnJpZ2h0ICYmIG5vZGUucmlnaHQuZGF0YSA9PT0gdmFsdWUgJiYgbm9kZS5yaWdodC5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQucmlnaHQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBub2RlLnJpZ2h0ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENhc2UgMjogZGVsZXRpbmcgYSBicmFuY2ggbm9kZSB3aXRoIG9uZSBsZWFmOyBwb2ludCB0aGUgcHJlY2VkaW5nIGNoaWxkIHRvIHRoZSAybmQgZm9sbG93aW5nIGNoaWxkXG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLmxlZnQgJiYgbm9kZS5sZWZ0LmRhdGEgPT09IHZhbHVlICYmIG5vZGUubGVmdC5sZWZ0ICE9PSBudWxsICYmIG5vZGUubGVmdC5sZWZ0LmxlZnQgPT09IG51bGwgXG4gICAgICAgICAgICAgICAgJiYgbm9kZS5sZWZ0LmxlZnQucmlnaHQgPT09IG51bGwgJiYgbm9kZS5sZWZ0LnJpZ2h0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IG5vZGUubGVmdC5sZWZ0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLmxlZnQgJiYgbm9kZS5sZWZ0LmRhdGEgPT09IHZhbHVlICYmIG5vZGUubGVmdC5yaWdodCAhPT0gbnVsbCAmJiBub2RlLmxlZnQucmlnaHQubGVmdCA9PT0gbnVsbCBcbiAgICAgICAgICAgICAgICAmJiBub2RlLmxlZnQucmlnaHQucmlnaHQgPT09IG51bGwgJiYgbm9kZS5sZWZ0LmxlZnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5sZWZ0ID0gbm9kZS5sZWZ0LnJpZ2h0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLnJpZ2h0ICYmIG5vZGUucmlnaHQuZGF0YSA9PT0gdmFsdWUgJiYgbm9kZS5yaWdodC5sZWZ0ICE9PSBudWxsICYmIG5vZGUucmlnaHQubGVmdC5sZWZ0ID09PSBudWxsIFxuICAgICAgICAgICAgICAgICYmIG5vZGUucmlnaHQubGVmdC5yaWdodCA9PT0gbnVsbCAmJiBub2RlLnJpZ2h0LnJpZ2h0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUucmlnaHQgPSBub2RlLnJpZ2h0LmxlZnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUucmlnaHQgJiYgbm9kZS5yaWdodC5kYXRhID09PSB2YWx1ZSAmJiBub2RlLnJpZ2h0LnJpZ2h0ICE9PSBudWxsICYmIG5vZGUucmlnaHQucmlnaHQubGVmdCA9PT0gbnVsbCBcbiAgICAgICAgICAgICAgICAmJiBub2RlLnJpZ2h0LnJpZ2h0LnJpZ2h0ID09PSBudWxsICYmIG5vZGUucmlnaHQubGVmdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBub2RlLnJpZ2h0ID0gbm9kZS5yaWdodC5yaWdodFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVE9ETzogZWRnZSBjYXNlIHdoZXJlIHJvb3QgaXMgaGFzIG9uZSBsZWFmICh0d28gbm9kZXMgb25seSBpbiB0aGUgdHJlZSlcbiAgICAgICAgICAgIC8vIHJlcXVpcmVzIGNoZWNraW5nIGlmIG5vZGUgaXMgcm9vdCwgYW5kIGNoZWNraW5nIGlmIGl0IG9ubHkgaGFzIG9uZSBsZWFmXG5cbiAgICAgICAgICAgIC8vIENhc2UgMzogZGVsZXRpbmcgYSBicmFuY2ggd2l0aCBib3RoIGxlYXZlczsgZ2V0IHRoZSBuZXh0IHJpZ2h0LCB0aGVuIGxlZnRtb3N0IGkgdGhpbmtcbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUuZGF0YSA9PT0gdmFsdWUgJiYgbm9kZS5sZWZ0ICE9PSBudWxsICYmIG5vZGUucmlnaHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IG5vZGUucmlnaHQ7XG4gICAgICAgICAgICAgICAgbGV0IHRlbXBQYXJlbnQgPSB0ZW1wO1xuICAgICAgICAgICAgICAgIHdoaWxlICh0ZW1wLmxlZnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcFBhcmVudCA9IHRlbXA7XG4gICAgICAgICAgICAgICAgICAgIHRlbXAgPSB0ZW1wLmxlZnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5vZGUuZGF0YSA9IHRlbXAuZGF0YTtcbiAgICAgICAgICAgICAgICB0ZW1wUGFyZW50LmxlZnQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ2FzZSA0OiBjb25zb2xlIGxvZyBpZiB0aGUgdmFsdWUgaXNuJ3QgZm91bmRcbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gbm9kZS5kYXRhICYmIG5vZGUucmlnaHQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt2YWx1ZX0gbm90IGZvdW5kLCBwbGVhc2UgdHJ5IGFnYWluYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCBub2RlLmRhdGEgJiYgbm9kZS5sZWZ0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCR7dmFsdWV9IG5vdCBmb3VuZCwgcGxlYXNlIHRyeSBhZ2FpbmApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgbm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUubGVmdCwgdmFsdWUpXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCB2YWx1ZSA+IG5vZGUuZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWN1cnNpdmVGdW5jdGlvbihub2RlLnJpZ2h0LCB2YWx1ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZWN1cnNpdmVGdW5jdGlvbih0aGlzLnJvb3QsIHZhbHVlKVxuICAgIH1cblxuICAgIGZpbmQodmFsdWUpIHtcbiAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlRnVuY3Rpb24obm9kZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChub2RlLmRhdGEgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobm9kZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB2YWx1ZSBleGlzdHMgYXQgbGVhZiBvciB0aGUgbGVhZiBwYXJlbnRzXG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IG5vZGUuZGF0YSAmJiBub2RlLnJpZ2h0ID09PSBudWxsKSBjb25zb2xlLmxvZyhgJHt2YWx1ZX0gbm90IGZvdW5kYClcbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgbm9kZS5kYXRhICYmIG5vZGUubGVmdCA9PT0gbnVsbCkgY29uc29sZS5sb2coYCR7dmFsdWV9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICAvLyBpZiBub2RlIG5vdCBmb3VuZCwgYW5kIG5vdCBhdCB0aGUgbGVhZiBub2RlcywgcmVjdXJzaXZlbHkgZ28gdGhyb3VnaCB0cmVlXG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IG5vZGUuZGF0YSkgcmV0dXJuIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUucmlnaHQsIHZhbHVlKVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCBub2RlLmRhdGEpIHJldHVybiByZWN1cnNpdmVGdW5jdGlvbihub2RlLmxlZnQsIHZhbHVlKVxuICAgICAgICB9XG4gICAgICAgIHJlY3Vyc2l2ZUZ1bmN0aW9uKHRoaXMucm9vdCwgdmFsdWUpXG4gICAgfVxuXG4gICAgbGV2ZWxPcmRlckl0ZXJhdGl2ZShoZWxwZXJGdW5jdGlvbikge1xuICAgICAgICBsZXQgcXVldWUgPSBbXVxuICAgICAgICBxdWV1ZS5wdXNoKHRoaXMucm9vdClcbiAgICAgICAgaWYgKGhlbHBlckZ1bmN0aW9uKSB7XG4gICAgICAgICAgICB3aGlsZSAocXVldWUubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgaGVscGVyRnVuY3Rpb24ocXVldWVbMF0pXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlWzBdLmxlZnQpIHF1ZXVlLnB1c2gocXVldWVbMF0ubGVmdClcbiAgICAgICAgICAgICAgICBpZiAocXVldWVbMF0ucmlnaHQpIHF1ZXVlLnB1c2gocXVldWVbMF0ucmlnaHQpXG4gICAgICAgICAgICAgICAgcXVldWUuc2hpZnQoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IGFycmF5ID0gW11cbiAgICAgICAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIGFycmF5LnB1c2gocXVldWVbMF0uZGF0YSk7XG4gICAgICAgICAgICBpZiAocXVldWVbMF0ubGVmdCkgcXVldWUucHVzaChxdWV1ZVswXS5sZWZ0KVxuICAgICAgICAgICAgaWYgKHF1ZXVlWzBdLnJpZ2h0KSBxdWV1ZS5wdXNoKHF1ZXVlWzBdLnJpZ2h0KVxuICAgICAgICAgICAgcXVldWUuc2hpZnQoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJlT3JkZXIoaGVscGVyRnVuY3Rpb24pIHtcbiAgICAgICAgaWYgKGhlbHBlckZ1bmN0aW9uKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVGdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICAgICAgaGVscGVyRnVuY3Rpb24obm9kZSlcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQgPT09IG51bGwpIHJldHVyblxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0KSByZWN1cnNpdmVGdW5jdGlvbihub2RlLmxlZnQpXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnJpZ2h0KSByZWN1cnNpdmVGdW5jdGlvbihub2RlLnJpZ2h0KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY3Vyc2l2ZUZ1bmN0aW9uKHRoaXMucm9vdClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVjdXJzaXZlVmFsdWUgPSBbbm9kZS5kYXRhXTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQgPT09IG51bGwpIHJldHVybiBbbm9kZS5kYXRhXVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0KSByZWN1cnNpdmVWYWx1ZSA9IHJlY3Vyc2l2ZVZhbHVlLmNvbmNhdChyZWN1cnNpdmVGdW5jdGlvbihub2RlLmxlZnQpKVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodCkgcmVjdXJzaXZlVmFsdWUgPSByZWN1cnNpdmVWYWx1ZS5jb25jYXQocmVjdXJzaXZlRnVuY3Rpb24obm9kZS5yaWdodCkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWN1cnNpdmVWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKHJlY3Vyc2l2ZUZ1bmN0aW9uKHRoaXMucm9vdCkpXG5cbiAgICAgICAgICAgIC8vIGNsZWFuZXIgdmVyc2lvbjsgYmFzZSBjYXNlIGlzIG5vdCBzdGF0ZWQsIGFzIGRvIG5vdCBuZWVkIHRvIHN0YXRlIGlmIG51bGxcbiAgICAgICAgICAgIC8vIGZ1bmN0aW9uIHJlY3Vyc2l2ZVRyYXZlcnNhbChub2RlKSB7XG4gICAgICAgICAgICAvLyBsZXQgYXJyYXkgPSBbbm9kZS5kYXRhXSAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gaWYgKG5vZGUubGVmdCkgYXJyYXkgPSBhcnJheS5jb25jYXQocmVjdXJzaXZlVHJhdmVyc2FsKG5vZGUubGVmdCkpIC8vIFwiY29ubmVjdGluZ1wiIGFycmF5c1xuICAgICAgICAgICAgLy8gaWYgKG5vZGUucmlnaHQpIGFycmF5ID0gYXJyYXkuY29uY2F0KHJlY3Vyc2l2ZVRyYXZlcnNhbChub2RlLnJpZ2h0KSkgLy8gXCJjb25uZWN0aW5nXCIgYXJyYXlzXG4gICAgICAgICAgICAvLyByZXR1cm4gYXJyYXlcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlY3Vyc2l2ZVRyYXZlcnNhbCh0aGlzLnJvb3QpKVxuICAgICAgICAgICAgLy8gfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gdHJhdmVyc2UgdGhlIGxlZnQgc3VidHJlZSwgdGhlbiB0aGUgcm9vdCwgdGhlbiB0aGUgcmlnaHQgc3VidHJlZS5cbiAgICBpbk9yZGVyKGhlbHBlckZ1bmN0aW9uKSB7XG4gICAgICAgIGlmIChoZWxwZXJGdW5jdGlvbikge1xuICAgICAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlRnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgICAgIGlmIChub2RlLmxlZnQgPT09IG51bGwgJiYgbm9kZS5yaWdodCA9PT0gbnVsbCkgaGVscGVyRnVuY3Rpb24obm9kZSlcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubGVmdCkgcmVjdXJzaXZlRnVuY3Rpb24obm9kZS5sZWZ0KVxuICAgICAgICAgICAgICAgICAgICBoZWxwZXJGdW5jdGlvbihub2RlKVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodCkgcmVjdXJzaXZlRnVuY3Rpb24obm9kZS5yaWdodClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWN1cnNpdmVGdW5jdGlvbih0aGlzLnJvb3QpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVGdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlY3Vyc2l2ZVZhbHVlID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmxlZnQpIHJlY3Vyc2l2ZVZhbHVlID0gcmVjdXJzaXZlVmFsdWUuY29uY2F0KHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUubGVmdCkpXG4gICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZVZhbHVlID0gcmVjdXJzaXZlVmFsdWUuY29uY2F0KFtub2RlLmRhdGFdKVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodCkgcmVjdXJzaXZlVmFsdWUgPSByZWN1cnNpdmVWYWx1ZS5jb25jYXQocmVjdXJzaXZlRnVuY3Rpb24obm9kZS5yaWdodCkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWN1cnNpdmVWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZWN1cnNpdmVGdW5jdGlvbih0aGlzLnJvb3QpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB0cmF2ZXJzZSB0aGUgbGVmdCBzdWJ0cmVlLCB0aGVuIHRoZSByaWdodCBzdWJ0cmVlLCB0aGVuIHRoZSByb290LlxuICAgIHBvc3RPcmRlcihoZWxwZXJGdW5jdGlvbikge1xuICAgICAgICBpZiAoaGVscGVyRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQgPT09IG51bGwpIGhlbHBlckZ1bmN0aW9uKG5vZGUpXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmxlZnQpIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUubGVmdClcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUucmlnaHQpIHJlY3Vyc2l2ZUZ1bmN0aW9uKG5vZGUucmlnaHQpXG4gICAgICAgICAgICAgICAgICAgIGhlbHBlckZ1bmN0aW9uKG5vZGUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjdXJzaXZlRnVuY3Rpb24odGhpcy5yb290KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlRnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgICAgIGxldCByZWN1cnNpdmVWYWx1ZSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0KSByZWN1cnNpdmVWYWx1ZSA9IHJlY3Vyc2l2ZVZhbHVlLmNvbmNhdChyZWN1cnNpdmVGdW5jdGlvbihub2RlLmxlZnQpKVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodCkgcmVjdXJzaXZlVmFsdWUgPSByZWN1cnNpdmVWYWx1ZS5jb25jYXQocmVjdXJzaXZlRnVuY3Rpb24obm9kZS5yaWdodCkpXG4gICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZVZhbHVlID0gcmVjdXJzaXZlVmFsdWUuY29uY2F0KFtub2RlLmRhdGFdKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjdXJzaXZlVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKHJlY3Vyc2l2ZUZ1bmN0aW9uKHRoaXMucm9vdCkpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyByZXR1cm4gdGhlIG1heCBkaXN0YW5jZSBiZXR3ZWVuIHNwZWNpZmllZCBub2RlLCBhbmQgaXRzIGxlYWYgbm9kZXMuIFxuICAgIGhlaWdodCh2YWx1ZSkge1xuICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVGaW5kKG5vZGUsIHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5kYXRhID09PSB2YWx1ZSkgcmV0dXJuIG5vZGU7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdmFsdWUgZXhpc3RzIGF0IGxlYWYgb3IgdGhlIGxlYWYgcGFyZW50c1xuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiBub2RlLmRhdGEgJiYgbm9kZS5yaWdodCA9PT0gbnVsbCkgcmV0dXJuXG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA8IG5vZGUuZGF0YSAmJiBub2RlLmxlZnQgPT09IG51bGwpIHJldHVyblxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiBub2RlLmRhdGEpIHJldHVybiByZWN1cnNpdmVGaW5kKG5vZGUucmlnaHQsIHZhbHVlKVxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCBub2RlLmRhdGEpIHJldHVybiByZWN1cnNpdmVGaW5kKG5vZGUubGVmdCwgdmFsdWUpXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVUcmF2ZXJzYWwobm9kZSwgY291bnRlciA9IDAsIGhlaWdodHMgPSBbXSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5sZWZ0ID09IG51bGwgJiYgbm9kZS5yaWdodCA9PSBudWxsKSBoZWlnaHRzLnB1c2goY291bnRlcilcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubGVmdCkgcmVjdXJzaXZlVHJhdmVyc2FsKG5vZGUubGVmdCwgY291bnRlcisxLCBoZWlnaHRzKVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodCkgcmVjdXJzaXZlVHJhdmVyc2FsKG5vZGUucmlnaHQsIGNvdW50ZXIrMSwgaGVpZ2h0cylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLmhlaWdodHMpXG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgY2F0Y2goZXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgndmFsdWUgbm90IGZvdW5kJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWN1cnNpdmVUcmF2ZXJzYWwocmVjdXJzaXZlRmluZCh0aGlzLnJvb3QsIHZhbHVlKSlcbiAgICB9XG5cblxuICAgIC8vIHRoaXMgaXMgc2ltaWxhciB0byBmaW5kLCBidXQgYSBjb3VudGVyIGlzIGludHJvZHVjZWQuIFJldHVybnMgZGlzdGFuY2UgYmV0d2VlbiByb290IGFuZCBzcGVjaWZpZWQgbm9kZS5cbiAgICBkZXB0aCh2YWx1ZSkge1xuICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVUcmF2ZXJzYWwobm9kZSwgdmFsdWUsIGNvdW50ZXI9MCkge1xuICAgICAgICAgICAgaWYgKG5vZGUuZGF0YSA9PT0gdmFsdWUpIHJldHVybiBjb3VudGVyXG4gICAgICAgICAgICBlbHNlIGlmIChub2RlLmxlZnQgPT0gbnVsbCAmJiBub2RlLnJpZ2h0ID09IG51bGwpIGNvbnNvbGUubG9nKCd2YWx1ZSBub3QgZm91bmQnKVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgbm9kZS5kYXRhKSByZXR1cm4gcmVjdXJzaXZlVHJhdmVyc2FsKG5vZGUubGVmdCwgdmFsdWUsIGNvdW50ZXIgKyAxKVxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IG5vZGUuZGF0YSkgcmV0dXJuIHJlY3Vyc2l2ZVRyYXZlcnNhbChub2RlLnJpZ2h0LCB2YWx1ZSwgY291bnRlciArIDEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlY3Vyc2l2ZVRyYXZlcnNhbCh0aGlzLnJvb3QsIHZhbHVlKVxuICAgIH1cblxuICAgIC8vIGNoZWNrIGVhY2ggbm9kZSBpZiBpdCBvbmx5IGhhcyBvbmUgYnJhbmNoIHdpdGggYSBoZWlnaHQgb2YgdHdvIG9yIGdyZWF0ZXI7IGlmIHNvLCByZXR1cm4gZmFsc2UuXG4gICAgaXNCYWxhbmNlZCgpIHtcbiAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlSXNCYWxhbmNlZChub2RlLCBib29sZWFuQ2hlY2tlciA9IFtdKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5yaWdodC5sZWZ0ID09PSBudWxsICYmIG5vZGUucmlnaHQucmlnaHQgPT09IG51bGwpIHJldHVyblxuICAgICAgICAgICAgICAgIGVsc2UgYm9vbGVhbkNoZWNrZXIucHVzaChmYWxzZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGUubGVmdCAhPT0gbnVsbCAmJiBub2RlLnJpZ2h0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubGVmdC5sZWZ0ID09PSBudWxsICYmIG5vZGUubGVmdC5yaWdodCA9PT0gbnVsbCkgcmV0dXJuXG4gICAgICAgICAgICAgICAgZWxzZSBib29sZWFuQ2hlY2tlci5wdXNoKGZhbHNlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubGVmdCkgcmVjdXJzaXZlSXNCYWxhbmNlZChub2RlLmxlZnQsIGJvb2xlYW5DaGVja2VyKVxuICAgICAgICAgICAgICAgIGlmIChub2RlLnJpZ2h0KSByZWN1cnNpdmVJc0JhbGFuY2VkKG5vZGUucmlnaHQsIGJvb2xlYW5DaGVja2VyKVxuICAgICAgICAgICAgICAgIGlmIChib29sZWFuQ2hlY2tlci5pbmNsdWRlcyhmYWxzZSkpIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVjdXJzaXZlSXNCYWxhbmNlZCh0aGlzLnJvb3QpXG4gICAgfVxuXG4gICAgLy8gaWYgdGhlIHRyZWUgaXMgdW5iYWxhbmNlZCwgcmViYWxhbmNlIHRoZSB0cmVlIHVzaW5nIGJ1aWxkVHJlZSgpLlxuICAgIHJlYmFsYW5jZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNCYWxhbmNlZCgpKSByZXR1cm5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBuZXdBcnJheSA9ICh0aGlzLmluT3JkZXIoKSlcbiAgICAgICAgICAgIHRoaXMucm9vdCA9IGJ1aWxkVHJlZShuZXdBcnJheSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuXG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFRyZWUoYXJyYXkpIHtcbiAgICAgICAgbGV0IHNvcnRlZEFycmF5ID0gbWVyZ2VTb3J0KGFycmF5KVxuICAgICAgICBsZXQgcmVtb3ZlZER1cGxpY2F0ZXMgPSBbLi4uIG5ldyBTZXQoc29ydGVkQXJyYXkpXVxuICAgICAgICByZXR1cm4gcmVjdXJzaXZlQnVpbGRUcmVlKHJlbW92ZWREdXBsaWNhdGVzKVxufVxuXG5mdW5jdGlvbiByZWN1cnNpdmVCdWlsZFRyZWUoYXJyYXkpIHtcbiAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBudWxsOyAvLyB3aGF0IGRvIGkgbmVlZCB0byByZXR1cm4/IGFycmF5PyBub2RlP1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gTWF0aC5mbG9vcihhcnJheS5sZW5ndGgvMilcbiAgICAgICAgY29uc3Qgcm9vdCA9IG5ldyBOb2RlKGFycmF5W21pZGRsZUluZGV4XSlcblxuICAgICAgICByb290LmxlZnQgPSByZWN1cnNpdmVCdWlsZFRyZWUoYXJyYXkuc2xpY2UoMCwgbWlkZGxlSW5kZXgpKVxuICAgICAgICByb290LnJpZ2h0ID0gcmVjdXJzaXZlQnVpbGRUcmVlKGFycmF5LnNsaWNlKG1pZGRsZUluZGV4ICsgMSkpXG4gICAgICAgIHJldHVybiByb290O1xuICAgIH1cbn1cblxuIiwiZXhwb3J0IGNvbnN0IHByZXR0eVByaW50ID0gKG5vZGUsIHByZWZpeCA9IFwiXCIsIGlzTGVmdCA9IHRydWUpID0+IHtcbiAgaWYgKG5vZGUgPT09IG51bGwpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKG5vZGUucmlnaHQgIT09IG51bGwpIHtcbiAgICBwcmV0dHlQcmludChub2RlLnJpZ2h0LCBgJHtwcmVmaXh9JHtpc0xlZnQgPyBcIuKUgiAgIFwiIDogXCIgICAgXCJ9YCwgZmFsc2UpO1xuICB9XG4gIGNvbnNvbGUubG9nKGAke3ByZWZpeH0ke2lzTGVmdCA/IFwi4pSU4pSA4pSAIFwiIDogXCLilIzilIDilIAgXCJ9JHtub2RlLmRhdGF9YCk7XG4gIGlmIChub2RlLmxlZnQgIT09IG51bGwpIHtcbiAgICBwcmV0dHlQcmludChub2RlLmxlZnQsIGAke3ByZWZpeH0ke2lzTGVmdCA/IFwiICAgIFwiIDogXCLilIIgICBcIn1gLCB0cnVlKTtcbiAgfVxufTsiLCJpbXBvcnQgeyBUcmVlIH0gZnJvbSBcIi4vQlNUXCI7XG5pbXBvcnQgeyBidWlsZFRyZWUgfSBmcm9tIFwiLi9CU1RcIjtcbmltcG9ydCB7IHByZXR0eVByaW50IH0gZnJvbSBcIi4vcHJldHR5UHJpbnRcIjtcblxuY29uc3QgdGVzdEFycmF5ID0gWzEsIDcsIDQsIDIzLCA4LCA5LCA0LCAzLCA1LCA3LCA5LCA2NywgNjM0NSwgMzI0XVxuXG5mdW5jdGlvbiBjcmVhdGVSYW5kb21BcnJheSgpIHtcbiAgICBsZXQgcmFuZG9tQXJyYXkgPSBbXVxuICAgIGNvbnN0IG51bUVsZW1lbnRzID0gMTBcbiAgICBjb25zdCBtYXhOdW0gPSAxMDBcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRWxlbWVudHM7IGkrKykge1xuICAgICAgICByYW5kb21BcnJheS5wdXNoKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bSkpXG4gICAgfVxuICAgIHJldHVybiByYW5kb21BcnJheVxufVxuXG5mdW5jdGlvbiB1bmJhbGFuY2VUcmVlKHRyZWUpIHtcbiAgICBjb25zdCBleHRyYU51bUVsZW1lbnRzID0gMTBcbiAgICBjb25zdCBtYXhOdW0gPSA5OTlcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXh0cmFOdW1FbGVtZW50czsgaSsrKSB7XG4gICAgICAgIHRyZWUuaW5zZXJ0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heE51bSkgKyAxMDApXG4gICAgfVxufVxuXG5cbi8vIGNvbnNvbGUubG9nKHRlc3RBcnJheSlcblxuLy8gYnVpbGRUcmVlKHRlc3RBcnJheSlcbi8vIGxldCBuZXdUcmVlID0gbmV3IFRyZWUodGVzdEFycmF5KVxubGV0IG5ld1RyZWUgPSBuZXcgVHJlZShjcmVhdGVSYW5kb21BcnJheSgpKVxuY29uc29sZS5sb2coXG4gICAgbmV3VHJlZS5pc0JhbGFuY2VkKClcbilcblxuY29uc29sZS5sb2coXG4gICAgJ2xldmVsIG9yZGVyJyxcbiAgICBuZXdUcmVlLmxldmVsT3JkZXJJdGVyYXRpdmUoKVxuKVxuY29uc29sZS5sb2coXG4gICAgJ3ByZSBvcmRlcicsXG4gICAgbmV3VHJlZS5wcmVPcmRlcigpXG4pXG5jb25zb2xlLmxvZyhcbiAgICAncG9zdCBvcmRlcicsXG4gICAgbmV3VHJlZS5wb3N0T3JkZXIoKVxuKVxuY29uc29sZS5sb2coXG4gICAgJ2luIG9yZGVyJyxcbiAgICBuZXdUcmVlLmluT3JkZXIoKVxuKVxuXG51bmJhbGFuY2VUcmVlKG5ld1RyZWUpXG5cbi8vIG5ld1RyZWUuaW5zZXJ0KDkpXG5wcmV0dHlQcmludChuZXdUcmVlLnJvb3QpXG5cbm5ld1RyZWUucmViYWxhbmNlKClcblxuY29uc29sZS5sb2coXG4gICAgbmV3VHJlZS5pc0JhbGFuY2VkKClcbilcblxucHJldHR5UHJpbnQobmV3VHJlZS5yb290KVxuLy8gbmV3VHJlZS5kZWxldGUoMzIzKVxuLy8gcHJldHR5UHJpbnQobmV3VHJlZS5yb290KVxuXG5uZXdUcmVlLmZpbmQoNilcbm5ld1RyZWUuZmluZCgxKVxubmV3VHJlZS5maW5kKDUpXG5cbi8vIG5ld1RyZWUubGV2ZWxPcmRlckl0ZXJhdGl2ZSgobm9kZSkgPT4gY29uc29sZS5sb2cobm9kZSkpXG5cbm5ld1RyZWUubGV2ZWxPcmRlckl0ZXJhdGl2ZSgpO1xubmV3VHJlZS5wcmVPcmRlcigpXG5cbi8vIG5ld1RyZWUucHJlT3JkZXIoKG5vZGUpPT4gY29uc29sZS5sb2cobm9kZS5kYXRhKSlcblxuLy8gbmV3VHJlZS5pbk9yZGVyKChub2RlKT0+Y29uc29sZS5sb2cobm9kZS5kYXRhKSlcblxubmV3VHJlZS5wb3N0T3JkZXIoKVxuXG4vLyBjb25zb2xlLmxvZyhcbi8vICAgICBuZXdUcmVlLmgsZWlnaHQoNTApXG4vLyApXG5cbi8vIGNvbnNvbGUubG9nKFxuLy8gICAgIG5ld1RyZWUuaGVpZ2h0KDYzNDUpXG4vLyApXG5cblxuXG4vLyBjb25zb2xlLmxvZyhcbi8vICAgICBuZXdUcmVlLmlzQmFsYW5jZWQoKVxuLy8gKVxuXG4vLyBuZXdUcmVlLmluc2VydCg5OTkpXG4vLyBuZXdUcmVlLmluc2VydCgzMjIpXG4vLyBuZXdUcmVlLmluc2VydCgzMjEpXG4vLyBuZXdUcmVlLmluc2VydCgzMjApXG4vLyBuZXdUcmVlLmluc2VydCgwKVxuLy8gcHJldHR5UHJpbnQobmV3VHJlZS5yb290KVxuLy8gY29uc29sZS5sb2coXG4vLyAgICAgbmV3VHJlZS5oZWlnaHQoMzI0NzcpXG4vLyApXG4vLyBjb25zb2xlLmxvZyhcbi8vICAgICBuZXdUcmVlLmRlcHRoKDMyMClcbi8vIClcbi8vIGNvbnNvbGUubG9nKFxuLy8gICAgIG5ld1RyZWUuaGVpZ2h0KDUpXG4vLyApXG4vLyBjb25zb2xlLmxvZyhcbi8vICAgICBuZXdUcmVlLmlzQmFsYW5jZWQyKClcbi8vIClcbi8vIGNvbnNvbGUubG9nKFxuLy8gICAgIG5ld1RyZWUuaXNCYWxhbmNlZCgpXG4vLyApXG5cbi8vIG5ld1RyZWUucmViYWxhbmNlKCk7Il0sIm5hbWVzIjpbIm1lcmdlU29ydCIsImFycmF5IiwibGVuZ3RoIiwiaGFsZiIsIk1hdGgiLCJjZWlsIiwic29ydGVkTGVmdEhhbGYiLCJzbGljZSIsInNvcnRlZFJpZ2h0SGFsZiIsIm1lcmdlZEFycmF5IiwicHVzaCIsInNoaWZ0IiwiTm9kZSIsImNvbnN0cnVjdG9yIiwidmFsdWUiLCJ0aGlzIiwiZGF0YSIsImxlZnQiLCJyaWdodCIsImJ1aWxkVHJlZSIsInNvcnRlZEFycmF5IiwicmVjdXJzaXZlQnVpbGRUcmVlIiwiU2V0IiwibWlkZGxlSW5kZXgiLCJmbG9vciIsInJvb3QiLCJwcmV0dHlQcmludCIsIm5vZGUiLCJwcmVmaXgiLCJpc0xlZnQiLCJjb25zb2xlIiwibG9nIiwibmV3VHJlZSIsImluc2VydCIsInJlY3Vyc2l2ZUZ1bmN0aW9uIiwibmV3Tm9kZSIsInRlbXAiLCJ0ZW1wUGFyZW50IiwiZmluZCIsImxldmVsT3JkZXJJdGVyYXRpdmUiLCJoZWxwZXJGdW5jdGlvbiIsInF1ZXVlIiwicHJlT3JkZXIiLCJyZWN1cnNpdmVWYWx1ZSIsImNvbmNhdCIsImluT3JkZXIiLCJwb3N0T3JkZXIiLCJoZWlnaHQiLCJyZWN1cnNpdmVUcmF2ZXJzYWwiLCJjb3VudGVyIiwiaGVpZ2h0cyIsIm1heCIsImVyciIsInJlY3Vyc2l2ZUZpbmQiLCJkZXB0aCIsImlzQmFsYW5jZWQiLCJyZWN1cnNpdmVJc0JhbGFuY2VkIiwiYm9vbGVhbkNoZWNrZXIiLCJpbmNsdWRlcyIsInJlYmFsYW5jZSIsIm5ld0FycmF5IiwicmFuZG9tQXJyYXkiLCJpIiwicmFuZG9tIiwiY3JlYXRlUmFuZG9tQXJyYXkiLCJ0cmVlIiwidW5iYWxhbmNlVHJlZSJdLCJzb3VyY2VSb290IjoiIn0=